@startuml
    partition Server {
        split
        -[hidden]->
        package Server {
            group RunServer(SourceServer, PipeServer, SinkServer) error {
                :Add PipeServer to SourceServer as Pushable;
                :Add SinkServer to PipeServer as Pushable;
                :Call Serve SinkServer;
                :Call Serve PipeServer;
                :Call Serve SourceServer;
                detach
            }
        }
        split again
        -[hidden]->
        package Producer {
            group getProducerServer(ProducerConfig) (ProducerServer, error) {
                :Create Producers and Producers map using config;
                :Create ProducerServer using Producers map;
                :Return ProducerServer;
                detach
            }
        }
        package Consumer {
            group getConsumerServer(ConsumerConfig) (ConsumerServer, error) {
                :Create Consumers and Consumers map using config;
                :Create ConsumerServer using Consumers map;
                :Return ConsumerServer;
                detach
            }
        }
        end split
    }
@enduml